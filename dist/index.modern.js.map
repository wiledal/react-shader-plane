{"version":3,"file":"index.modern.js","sources":["../src/index.js"],"sourcesContent":["import React from \"react\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { Texture, Mesh, PlaneBufferGeometry, MeshBasicMaterial } from \"three\";\nimport { useThree, useFrame, Canvas } from \"react-three-fiber\";\n\nlet defaultShader = `\n  vec4 texelColor = texture2D( map, vUv );\n  texelColor = mapTexelToLinear( texelColor );\n  diffuseColor = texelColor;\n`;\n\nlet defaultUniforms = {\n  uTime: {\n    type: \"float\",\n    value: 0\n  },\n  uMouse: {\n    type: \"vec2\",\n    value: [0, 0]\n  }\n};\n\nfunction printUniform(key, data) {\n  return `uniform ${data.type} ${key};`;\n}\n\nfunction printUniforms(uniforms) {\n  let keys = Object.keys(uniforms);\n\n  return `\n    ${keys.map(key => printUniform(key, uniforms[key])).join(\"\")}\n  `;\n}\n\nexport function Plane(props) {\n  let { camera, gl, mouse } = useThree();\n  let [plane, setPlane] = useState();\n  let [shader, setShader] = useState();\n\n  function onBeforeCompile(shader) {\n    let newUniforms = {\n      ...defaultUniforms,\n      ...props.uniforms\n    };\n\n    shader.uniforms = {\n      ...shader.uniforms,\n      ...newUniforms\n    };\n    shader.fragmentShader =\n      `\n      ${printUniforms(newUniforms)}\n    ` +\n      shader.fragmentShader\n        .replace(\n          \"#include <common>\",\n          `\n      ${props.functions || \"\"}\n\n      #include <common>\n    `\n        )\n        .replace(\n          \"#include <map_fragment>\",\n          `\n        ${props.fragmentShader || defaultShader}\n      `\n        );\n\n    setShader(shader);\n  }\n\n  useEffect(() => {\n    camera.position.z = 500;\n\n    let geom = new PlaneBufferGeometry(1, 1, 24, 24);\n    let mat = new MeshBasicMaterial({\n      map: props.map,\n      onBeforeCompile: onBeforeCompile\n    });\n    let mesh = new Mesh(geom, mat);\n\n    setPlane(mesh);\n  }, []);\n\n  useFrame(() => {\n    if (shader) {\n      shader.uniforms.uTime.value = performance.now();\n      plane.scale.x = gl.domElement.width;\n      plane.scale.y = gl.domElement.height;\n      shader.uniforms.uMouse.value = [mouse.x, mouse.y];\n    }\n\n    if (props.onFrame) props.onFrame(shader);\n  });\n\n  return (\n    <React.Fragment>{plane && <primitive object={plane} />}</React.Fragment>\n  );\n}\n\nexport default function ShaderPlane(\n  props = {\n    uniforms: [],\n    map: Texture,\n    fragmentShader: defaultShader,\n    functions: ``,\n    onFrame: Function\n  }\n) {\n  return (\n    <Canvas orthographic>\n      <Plane {...props} />\n    </Canvas>\n  );\n}\n"],"names":["defaultShader","defaultUniforms","uTime","type","value","uMouse","Plane","props","useThree","camera","gl","mouse","useState","plane","setPlane","shader","setShader","onBeforeCompile","uniforms","newUniforms","fragmentShader","Object","keys","map","key","data","printUniform","join","replace","functions","useEffect","position","z","geom","PlaneBufferGeometry","mat","MeshBasicMaterial","mesh","Mesh","useFrame","performance","now","scale","x","domElement","width","y","height","onFrame","React","Fragment","object","Texture","Function","Canvas","orthographic"],"mappings":"maAKA,IAAIA,iIAMAC,EAAkB,CACpBC,MAAO,CACLC,KAAM,QACNC,MAAO,GAETC,OAAQ,CACNF,KAAM,OACNC,MAAO,CAAC,EAAG,cAgBCE,EAAMC,SACQC,IAAtBC,IAAAA,OAAQC,IAAAA,GAAIC,IAAAA,QACMC,IAAnBC,OAAOC,SACcF,IAArBG,OAAQC,OAEb,SAASC,EAAgBF,GACvB,IAdmBG,EAcfC,OACClB,KACAM,EAAMW,UAGXH,EAAOG,cACFH,EAAOG,YACPC,GAELJ,EAAOK,eACL,YAxBiBF,EAyBDC,WAxBTE,OAAOC,KAAKJ,GAGdK,IAAI,SAAAC,UARf,SAAsBA,EAAKC,GACzB,iBAAkBA,EAAKtB,SAAQqB,MAOXE,CAAaF,EAAKN,EAASM,MAAOG,KAAK,IAoBvD,cAGAZ,EAAOK,eACJQ,QACC,gCAEFrB,EAAMsB,WAAa,yCAKlBD,QACC,wCAEArB,EAAMa,gBAAkBpB,eAI9BgB,EAAUD,GA2BZ,OAxBAe,EAAU,WACRrB,EAAOsB,SAASC,EAAI,IAEpB,IAAIC,EAAO,IAAIC,EAAoB,EAAG,EAAG,GAAI,IACzCC,EAAM,IAAIC,EAAkB,CAC9Bb,IAAKhB,EAAMgB,IACXN,gBAAiBA,IAEfoB,EAAO,IAAIC,EAAKL,EAAME,GAE1BrB,EAASuB,IACR,IAEHE,EAAS,WACHxB,IACFA,EAAOG,SAAShB,MAAME,MAAQoC,YAAYC,MAC1C5B,EAAM6B,MAAMC,EAAIjC,EAAGkC,WAAWC,MAC9BhC,EAAM6B,MAAMI,EAAIpC,EAAGkC,WAAWG,OAC9BhC,EAAOG,SAASb,OAAOD,MAAQ,CAACO,EAAMgC,EAAGhC,EAAMmC,IAG7CvC,EAAMyC,SAASzC,EAAMyC,QAAQjC,KAIjCkC,gBAACA,EAAMC,cAAUrC,GAASoC,6BAAWE,OAAQtC,6BAK/CN,GAQA,gBARAA,IAAAA,EAAQ,CACNW,SAAU,GACVK,IAAK6B,EACLhC,eAAgBpB,EAChB6B,aACAmB,QAASK,WAITJ,gBAACK,GAAOC,iBACNN,gBAAC3C,EAAUC"}